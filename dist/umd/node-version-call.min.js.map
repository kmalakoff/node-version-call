{"version":3,"file":"node-version-call.min.js","sources":["../../src/index.ts"],"sourcesContent":["const path = require('path');\nconst fs = require('fs');\nconst tmpdir = require('os').tmpdir || require('os-shim').tmpdir;\nconst suffix = require('temp-suffix');\nconst mkdirp = require('mkdirp');\nconst spawnSync = require('cross-spawn-cb').sync;\nconst JSONBuffer = require('./json-buffer');\n\nexport interface JSONObject {\n  [x: string]: any;\n}\nexport type CallOptions = {\n  args?: any[];\n  env?: JSONObject;\n};\n\nconst localCallFile = path.join(__dirname, 'localCall.js');\n\nexport default function call(filePath: string, version: string, options: CallOptions = {}): any {\n  const env = options.env || process.env;\n\n  const args = options.args || [];\n  const callData = { filePath, args };\n  const inputFile = path.join(tmpdir(), 'nvc', suffix('input'));\n  const outputFile = path.join(tmpdir(), 'nvc', suffix('output'));\n\n  // store data to a file\n  mkdirp.sync(path.dirname(inputFile));\n  fs.writeFileSync(inputFile, JSONBuffer.stringify(callData));\n\n  // call the function\n  spawnSync('nvu', [version, 'node', localCallFile, inputFile, outputFile], { env, stdio: 'string' });\n\n  // get data and clean up\n  const responseData = JSONBuffer.parse(fs.readFileSync(outputFile, 'utf8'));\n  try {\n    fs.unlinkSync(inputFile);\n  } catch {\n    // skip\n  }\n  try {\n    fs.unlinkSync(outputFile);\n  } catch {\n    // skip\n  }\n  return responseData.value;\n}\n"],"names":["path","require","fs","tmpdir","suffix","mkdirp","spawnSync","sync","JSONBuffer","localCallFile","join","__dirname","filePath","version","options","length","arguments","env","process","args","callData","inputFile","outputFile","dirname","writeFileSync","stringify","stdio","responseData","parse","readFileSync","unlinkSync","e","e1","value"],"mappings":"gPAAA,IAAMA,EAAOC,QAAQ,QACfC,EAAKD,QAAQ,MACbE,EAASF,QAAQ,MAAME,QAAUF,QAAQ,WAAWE,OACpDC,EAASH,QAAQ,eACjBI,EAASJ,QAAQ,UACjBK,EAAYL,QAAQ,kBAAkBM,KACtCC,EAAaP,QAAQ,iBAUrBQ,EAAgBT,EAAKU,KAAKC,UAAW,uBAE5B,SAAcC,EAAkBC,OAAiBC,EAAAA,UAAyBC,OAAA,QAAA,IAAAC,UAAA,GAAAA,UAAA,GAAF,GAC/EC,EAAMH,EAAQG,KAAOC,QAAQD,IAE7BE,EAAOL,EAAQK,MAAQ,GACvBC,EAAW,CAAER,SAAAA,EAAUO,KAAAA,GACvBE,EAAYrB,EAAKU,KAAKP,IAAU,MAAOC,EAAO,UAC9CkB,EAAatB,EAAKU,KAAKP,IAAU,MAAOC,EAAO,WAGrDC,EAAOE,KAAKP,EAAKuB,QAAQF,IACzBnB,EAAGsB,cAAcH,EAAWb,EAAWiB,UAAUL,IAGjDd,EAAU,MAAO,CAACO,EAAS,OAAQJ,EAAeY,EAAWC,GAAa,CAAEL,IAAAA,EAAKS,MAAO,WAGxF,IAAMC,EAAenB,EAAWoB,MAAM1B,EAAG2B,aAAaP,EAAY,SAClE,IACEpB,EAAG4B,WAAWT,GACd,MAAMU,IAGR,IACE7B,EAAG4B,WAAWR,GACd,MAAMU,IAGR,OAAOL,EAAaM"}