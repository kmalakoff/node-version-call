{"version":3,"file":"node-version-call.js","sources":["../../src/index.ts"],"sourcesContent":["const path = require('path');\nconst fs = require('fs');\nconst tmpdir = require('os').tmpdir || require('os-shim').tmpdir;\nconst suffix = require('temp-suffix');\nconst mkdirp = require('mkdirp');\nconst spawnSync = require('cross-spawn-cb').sync;\nconst JSONBuffer = require('./json-buffer');\n\nexport interface JSONObject {\n  [x: string]: any;\n}\nexport type CallOptions = {\n  args?: any[];\n  env?: JSONObject;\n};\n\nconst localCallFile = path.join(__dirname, 'localCall.js');\n\nexport default function call(filePath: string, version: string, options: CallOptions = {}): any {\n  const env = options.env || process.env;\n\n  const args = options.args || [];\n  const callData = { filePath, args };\n  const inputFile = path.join(tmpdir(), 'nvc', suffix('input'));\n  const outputFile = path.join(tmpdir(), 'nvc', suffix('output'));\n\n  // store data to a file\n  mkdirp.sync(path.dirname(inputFile));\n  fs.writeFileSync(inputFile, JSONBuffer.stringify(callData));\n\n  // call the function\n  spawnSync('nvu', [version, 'node', localCallFile, inputFile, outputFile], { env, stdio: 'string' });\n\n  // get data and clean up\n  const responseData = JSONBuffer.parse(fs.readFileSync(outputFile, 'utf8'));\n  try {\n    fs.unlinkSync(inputFile);\n  } catch {\n    // skip\n  }\n  try {\n    fs.unlinkSync(outputFile);\n  } catch {\n    // skip\n  }\n  return responseData.value;\n}\n"],"names":["path","require","fs","tmpdir","suffix","mkdirp","spawnSync","sync","JSONBuffer","localCallFile","join","__dirname","call","filePath","version","options","env","process","args","callData","inputFile","outputFile","dirname","writeFileSync","stringify","stdio","responseData","parse","readFileSync","unlinkSync","value"],"mappings":";;;;;;EAAA,IAAMA,IAAI,GAAGC,OAAO,CAAC,MAAM,CAAC,CAAC;EAC7B,IAAMC,EAAE,GAAGD,OAAO,CAAC,IAAI,CAAC,CAAC;EACzB,IAAME,MAAM,GAAGF,OAAO,CAAC,IAAI,CAAC,CAACE,MAAM,IAAIF,OAAO,CAAC,SAAS,CAAC,CAACE,MAAM,CAAC;EACjE,IAAMC,MAAM,GAAGH,OAAO,CAAC,aAAa,CAAC,CAAC;EACtC,IAAMI,MAAM,GAAGJ,OAAO,CAAC,QAAQ,CAAC,CAAC;EACjC,IAAMK,SAAS,GAAGL,OAAO,CAAC,gBAAgB,CAAC,CAACM,IAAI,CAAC;EACjD,IAAMC,UAAU,GAAGP,OAAO,CAAC,eAAe,CAAC,CAAC;EAU5C,IAAMQ,aAAa,GAAGT,IAAI,CAACU,IAAI,CAACC,SAAS,EAAE,cAAc,CAAC,CAAC;EAE5C,SAASC,IAAI,CAACC,QAAgB,EAAEC,OAAe,EAAkC;UAAhCC,OAAoB,GAApBA,SAAyB,CAAA,MAAA,GAAA,CAAA,IAAA,SAAA,CAAA,CAAA,CAAA,KAAA,KAAA,CAAA,GAAA,SAAA,CAAA,CAAA,CAAA,GAAF,EAAE,CAAA;MACvF,IAAMC,GAAG,GAAGD,OAAO,CAACC,GAAG,IAAIC,OAAO,CAACD,GAAG,CAAC;EAEvC,IAAA,IAAME,IAAI,GAAGH,OAAO,CAACG,IAAI,IAAI,EAAE,CAAC;EAChC,IAAA,IAAMC,QAAQ,GAAG;EAAEN,QAAAA,QAAQ,EAARA,QAAQ;EAAEK,QAAAA,IAAI,EAAJA,IAAI;OAAE,CAAC;EACpC,IAAA,IAAME,SAAS,GAAGpB,IAAI,CAACU,IAAI,CAACP,MAAM,EAAE,EAAE,KAAK,EAAEC,MAAM,CAAC,OAAO,CAAC,CAAC,CAAC;EAC9D,IAAA,IAAMiB,UAAU,GAAGrB,IAAI,CAACU,IAAI,CAACP,MAAM,EAAE,EAAE,KAAK,EAAEC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC;;MAGhEC,MAAM,CAACE,IAAI,CAACP,IAAI,CAACsB,OAAO,CAACF,SAAS,CAAC,CAAC,CAAC;EACrClB,IAAAA,EAAE,CAACqB,aAAa,CAACH,SAAS,EAAEZ,UAAU,CAACgB,SAAS,CAACL,QAAQ,CAAC,CAAC,CAAC;;MAG5Db,SAAS,CAAC,KAAK,EAAE;UAACQ,OAAO;UAAE,MAAM;UAAEL,aAAa;UAAEW,SAAS;UAAEC,UAAU;OAAC,EAAE;EAAEL,QAAAA,GAAG,EAAHA,GAAG;EAAES,QAAAA,KAAK,EAAE,QAAQ;EAAE,KAAA,CAAC,CAAC;;EAGpG,IAAA,IAAMC,YAAY,GAAGlB,UAAU,CAACmB,KAAK,CAACzB,EAAE,CAAC0B,YAAY,CAACP,UAAU,EAAE,MAAM,CAAC,CAAC,CAAC;MAC3E,IAAI;EACFnB,QAAAA,EAAE,CAAC2B,UAAU,CAACT,SAAS,CAAC,CAAC;EAC1B,KAAA,CAAC,OAAM,CAAA,EAAA;;EAEP,KAAA;MACD,IAAI;EACFlB,QAAAA,EAAE,CAAC2B,UAAU,CAACR,UAAU,CAAC,CAAC;EAC3B,KAAA,CAAC,OAAM,EAAA,EAAA;;EAEP,KAAA;MACD,OAAOK,YAAY,CAACI,KAAK,CAAC;;;;;;;;;"}