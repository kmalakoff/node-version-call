{"version":3,"sources":["worker.ts"],"sourcesContent":["require('./polyfills');\nconst fs = require('fs');\nconst serialize = require('serialize-javascript');\n\nconst input = process.argv[2];\nconst output = process.argv[3];\n\nfunction writeResult(result) {\n  fs.writeFile(output + '.tmp', serialize(result, { unsafe: true }, 'utf8'), function () {\n    fs.rename(output + '.tmp', output, function () {\n      process.exit(0);\n    });\n  });\n}\n\n// get data\ntry {\n  const workerData = eval(`(${fs.readFileSync(input, 'utf8')})`);\n\n  // set up env\n  if (process.cwd() !== workerData.cwd) process.chdir(workerData.cwd);\n  for (const key in workerData.env) {\n    if (process.env[key] !== undefined) process.env[key] = workerData.env[key];\n  }\n\n  // call function\n  const fn = require(workerData.filePath);\n  const value = typeof fn == 'function' ? fn.apply(null, workerData.args) : fn;\n  writeResult({ value });\n} catch (err) {\n  writeResult({ error: { message: err.message, stack: err.stack } });\n}\n"],"names":["require","fs","serialize","input","process","argv","output","writeResult","result","writeFile","unsafe","rename","exit","workerData","eval","readFileSync","cwd","chdir","key","env","undefined","fn","filePath","value","apply","args","err","error","message","stack"],"mappings":"AAAAA;AAAAA,OAAO,CAAC,aAAa,CAAC,CAAC;AACvB,IAAMC,EAAE,GAAGD,OAAO,CAAC,IAAI,CAAC,AAAC;AACzB,IAAME,SAAS,GAAGF,OAAO,CAAC,sBAAsB,CAAC,AAAC;AAElD,IAAMG,KAAK,GAAGC,OAAO,CAACC,IAAI,CAAC,CAAC,CAAC,AAAC;AAC9B,IAAMC,MAAM,GAAGF,OAAO,CAACC,IAAI,CAAC,CAAC,CAAC,AAAC;AAE/B,SAASE,WAAW,CAACC,MAAM,EAAE;IAC3BP,EAAE,CAACQ,SAAS,CAACH,MAAM,GAAG,MAAM,EAAEJ,SAAS,CAACM,MAAM,EAAE;QAAEE,MAAM,EAAE,IAAI;KAAE,EAAE,MAAM,CAAC,EAAE,WAAY;QACrFT,EAAE,CAACU,MAAM,CAACL,MAAM,GAAG,MAAM,EAAEA,MAAM,EAAE,WAAY;YAC7CF,OAAO,CAACQ,IAAI,CAAC,CAAC,CAAC,CAAC;SACjB,CAAC,CAAC;KACJ,CAAC,CAAC;CACJ;AAED,WAAW;AACX,IAAI;IACF,IAAMC,UAAU,GAAGC,IAAI,CAAC,AAAC,GAAC,CAAiC,MAAC,CAAhCb,EAAE,CAACc,YAAY,CAACZ,KAAK,EAAE,MAAM,CAAC,EAAC,GAAC,CAAC,CAAC,AAAC;IAE/D,aAAa;IACb,IAAIC,OAAO,CAACY,GAAG,EAAE,KAAKH,UAAU,CAACG,GAAG,EAAEZ,OAAO,CAACa,KAAK,CAACJ,UAAU,CAACG,GAAG,CAAC,CAAC;IACpE,IAAK,IAAME,GAAG,IAAIL,UAAU,CAACM,GAAG,CAAE;QAChC,IAAIf,OAAO,CAACe,GAAG,CAACD,GAAG,CAAC,KAAKE,SAAS,EAAEhB,OAAO,CAACe,GAAG,CAACD,GAAG,CAAC,GAAGL,UAAU,CAACM,GAAG,CAACD,GAAG,CAAC,CAAC;KAC5E;IAED,gBAAgB;IAChB,IAAMG,EAAE,GAAGrB,OAAO,CAACa,UAAU,CAACS,QAAQ,CAAC,AAAC;IACxC,IAAMC,KAAK,GAAG,OAAOF,EAAE,IAAI,UAAU,GAAGA,EAAE,CAACG,KAAK,CAAC,IAAI,EAAEX,UAAU,CAACY,IAAI,CAAC,GAAGJ,EAAE,AAAC;IAC7Ed,WAAW,CAAC;QAAEgB,KAAK,EAALA,KAAK;KAAE,CAAC,CAAC;CACxB,CAAC,OAAOG,GAAG,EAAE;IACZnB,WAAW,CAAC;QAAEoB,KAAK,EAAE;YAAEC,OAAO,EAAEF,GAAG,CAACE,OAAO;YAAEC,KAAK,EAAEH,GAAG,CAACG,KAAK;SAAE;KAAE,CAAC,CAAC;CACpE"}