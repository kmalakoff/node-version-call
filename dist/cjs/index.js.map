{"version":3,"sources":["index.ts"],"sourcesContent":["const path = require('path');\nconst fs = require('fs');\nconst tmpdir = require('os').tmpdir || require('os-shim').tmpdir;\nconst suffix = require('temp-suffix');\nconst mkdirp = require('mkdirp');\nconst spawnSync = require('cross-spawn-cb').sync;\nconst JSONBuffer = require('./json-buffer');\n\nexport interface JSONObject {\n  [x: string]: any;\n}\nexport type CallOptions = {\n  args?: any[];\n  env?: JSONObject;\n};\n\nconst localCallFile = path.join(__dirname, 'localCall.js');\n\nexport default function call(filePath: string, version: string, options: CallOptions = {}): any {\n  const env = options.env || process.env;\n\n  const args = options.args || [];\n  const callData = { filePath, args };\n  const inputFile = path.join(tmpdir(), 'nvc', suffix('input'));\n  const outputFile = path.join(tmpdir(), 'nvc', suffix('output'));\n\n  // store data to a file\n  mkdirp.sync(path.dirname(inputFile));\n  fs.writeFileSync(inputFile, JSONBuffer.stringify(callData));\n\n  // call the function\n  spawnSync('nvu', [version, 'node', localCallFile, inputFile, outputFile], { env, stdio: 'string' });\n\n  // get data and clean up\n  const responseData = JSONBuffer.parse(fs.readFileSync(outputFile, 'utf8'));\n  try {\n    fs.unlinkSync(inputFile);\n  } catch {\n    // skip\n  }\n  try {\n    fs.unlinkSync(outputFile);\n  } catch {\n    // skip\n  }\n  return responseData.value;\n}\n"],"names":["call","filePath","version","options","env","process","args","callData","inputFile","path","join","tmpdir","suffix","outputFile","mkdirp","sync","dirname","fs","writeFileSync","JSONBuffer","stringify","spawnSync","localCallFile","stdio","responseData","parse","readFileSync","unlinkSync","value","require","__dirname"],"mappings":"AAAA;;;;kBAkBwBA,IAAI;AAAb,SAASA,IAAI,CAACC,QAAgB,EAAEC,OAAe,EAAkC;QAAhCC,OAAoB,GAApBA,+CAAyB,kBAAF,EAAE;IACvF,IAAMC,GAAG,GAAGD,OAAO,CAACC,GAAG,IAAIC,OAAO,CAACD,GAAG,AAAC;IAEvC,IAAME,IAAI,GAAGH,OAAO,CAACG,IAAI,IAAI,EAAE,AAAC;IAChC,IAAMC,QAAQ,GAAG;QAAEN,QAAQ,EAARA,QAAQ;QAAEK,IAAI,EAAJA,IAAI;KAAE,AAAC;IACpC,IAAME,SAAS,GAAGC,IAAI,CAACC,IAAI,CAACC,MAAM,EAAE,EAAE,KAAK,EAAEC,MAAM,CAAC,OAAO,CAAC,CAAC,AAAC;IAC9D,IAAMC,UAAU,GAAGJ,IAAI,CAACC,IAAI,CAACC,MAAM,EAAE,EAAE,KAAK,EAAEC,MAAM,CAAC,QAAQ,CAAC,CAAC,AAAC;IAEhE,uBAAuB;IACvBE,MAAM,CAACC,IAAI,CAACN,IAAI,CAACO,OAAO,CAACR,SAAS,CAAC,CAAC,CAAC;IACrCS,EAAE,CAACC,aAAa,CAACV,SAAS,EAAEW,UAAU,CAACC,SAAS,CAACb,QAAQ,CAAC,CAAC,CAAC;IAE5D,oBAAoB;IACpBc,SAAS,CAAC,KAAK,EAAE;QAACnB,OAAO;QAAE,MAAM;QAAEoB,aAAa;QAAEd,SAAS;QAAEK,UAAU;KAAC,EAAE;QAAET,GAAG,EAAHA,GAAG;QAAEmB,KAAK,EAAE,QAAQ;KAAE,CAAC,CAAC;IAEpG,wBAAwB;IACxB,IAAMC,YAAY,GAAGL,UAAU,CAACM,KAAK,CAACR,EAAE,CAACS,YAAY,CAACb,UAAU,EAAE,MAAM,CAAC,CAAC,AAAC;IAC3E,IAAI;QACFI,EAAE,CAACU,UAAU,CAACnB,SAAS,CAAC,CAAC;KAC1B,CAAC,UAAM;IACN,OAAO;KACR;IACD,IAAI;QACFS,EAAE,CAACU,UAAU,CAACd,UAAU,CAAC,CAAC;KAC3B,CAAC,WAAM;IACN,OAAO;KACR;IACD,OAAOW,YAAY,CAACI,KAAK,CAAC;CAC3B;AA9CD,IAAMnB,IAAI,GAAGoB,OAAO,CAAC,MAAM,CAAC,AAAC;AAC7B,IAAMZ,EAAE,GAAGY,OAAO,CAAC,IAAI,CAAC,AAAC;AACzB,IAAMlB,MAAM,GAAGkB,OAAO,CAAC,IAAI,CAAC,CAAClB,MAAM,IAAIkB,OAAO,CAAC,SAAS,CAAC,CAAClB,MAAM,AAAC;AACjE,IAAMC,MAAM,GAAGiB,OAAO,CAAC,aAAa,CAAC,AAAC;AACtC,IAAMf,MAAM,GAAGe,OAAO,CAAC,QAAQ,CAAC,AAAC;AACjC,IAAMR,SAAS,GAAGQ,OAAO,CAAC,gBAAgB,CAAC,CAACd,IAAI,AAAC;AACjD,IAAMI,UAAU,GAAGU,OAAO,CAAC,eAAe,CAAC,AAAC;AAU5C,IAAMP,aAAa,GAAGb,IAAI,CAACC,IAAI,CAACoB,SAAS,EAAE,cAAc,CAAC,AAAC"}